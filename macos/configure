#!/usr/bin/env bash
set -e

if ! command -v defaults > /dev/null 2>&1; then
    echo "\`defaults\` not found. Nothing to do."
    exit 0
fi

echo "Configuring macOS defaults..."

# ── 言語・表示 ──────────────────────────────────────────────────────
defaults write -g AppleLanguages '( "en-JP", "ja-JP")'
defaults write -g AppleShowScrollBars -string "WhenScrolling"
defaults write -g AppleShowAllExtensions -bool true

# ── キーボード・トラックパッド ──────────────────────────────────────
defaults write -g KeyRepeat -int 1
defaults write -g InitialKeyRepeat -int 10
defaults write -g com.apple.trackpad.scaling 3
defaults write -g com.apple.mouse.scaling 1.5
defaults write -g com.apple.mouse.tapBehavior -int 1
defaults write com.apple.AppleMultitouchTrackpad Clicking -bool true

# 三本指でドラッグ
defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad TrackpadThreeFingerDrag -bool true
defaults write com.apple.AppleMultitouchTrackpad TrackpadThreeFingerDrag -bool true

# 自動修正・自動大文字を無効化
defaults write -g NSAutomaticSpellingCorrectionEnabled -bool false
defaults write -g NSAutomaticCapitalizationEnabled -bool false
defaults write -g NSAutomaticPeriodSubstitutionEnabled -bool false

# ── Dock ────────────────────────────────────────────────────────────
defaults write com.apple.dock autohide -bool true
defaults write com.apple.dock autohide-delay -float 0
defaults write com.apple.dock autohide-time-modifier -float 0.3
defaults write com.apple.dock tilesize -int 48
defaults write com.apple.dock show-recents -bool false

# ── Finder ──────────────────────────────────────────────────────────
defaults write com.apple.finder ShowPathbar -bool true
defaults write com.apple.finder ShowStatusBar -bool true
defaults write com.apple.finder AppleShowAllFiles -bool true
defaults write com.apple.finder FXDefaultSearchScope -string "SCcf"  # 現在のフォルダ内を検索
defaults write com.apple.finder FXEnableExtensionChangeWarning -bool false

# .DS_Store をネットワーク・USB ドライブに作らない
defaults write com.apple.desktopservices DSDontWriteNetworkStores -bool true
defaults write com.apple.desktopservices DSDontWriteUSBStores -bool true

# ── スクリーンショット ──────────────────────────────────────────────
defaults write com.apple.screencapture location -string "$HOME/Desktop"
defaults write com.apple.screencapture type -string "png"
defaults write com.apple.screencapture disable-shadow -bool true

# ── セキュリティ・ダイアログ ────────────────────────────────────────
defaults write com.apple.CrashReporter DialogType -string "none"
defaults write com.apple.CrashReporter UseUNC -bool true
defaults write com.apple.LaunchServices LSQuarantine -bool false

# ── その他 ──────────────────────────────────────────────────────────
defaults write com.apple.TextEdit RichText -int 0
defaults write com.apple.menuextra.battery ShowPercent -string "YES"

# Spotlight: Option + Space
defaults write com.apple.symbolichotkeys AppleSymbolicHotKeys -dict-add 64 "<dict><key>enabled</key><true/><key>value</key><dict><key>parameters</key><array><integer>65535</integer><integer>49</integer><integer>524288</integer></array><key>type</key><string>standard</string></dict></dict>"

echo "Configuration complete!"
echo "Please restart Mac to make sure settings are reflected."
echo "Run 'killall Dock Finder SystemUIServer' for immediate partial effect."
